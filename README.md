# Urbs-emobpy-car-sharing
Documentation of using the Emobpy BEV time series generation tool as demand input to the Urbs model

# Getting Started 
## Emobpy Installation 
Following the steps outlined in the “Getting Started” section of the emobpy documentation, install emobpy and create a project folder. 
https://emobpy.readthedocs.io/en/latest/gettingstarted/installation.html

## Urbs Installation 
https://urbs.readthedocs.io/en/latest/users_guide/get_started.html

# Emobpy Time Series Generation 
[main script](main.py)

The webinar lined below walks through Emobpy installation, input parameters and time series generation: 
https://youtu.be/uW1f1eUAc68

* Inputs: 
  - Number of vehicles 
  - Time step 
  - Number of hours 
  - Charging Strategy 
  - Vechicle Type(s) 
 
 * Outputs: Separate CSV files with time series data for all BEV’s for the following values: 
    - "State.csv", label as home, work, shop, leisure, or escort
    - "charging_point.csv”, location of assigned charging point (none, public, workplace) 
    - "distance.csv", distance driven in km
    - "charge_grid.csv", kW demand for charging to the grid
    - "charge_battery.csv", kW demand to the battery accounting for losses 

* The “config_files” folder contains input files with mobility data from the Mobility in Germany study on trips per day, probability distribution for departure and destination, and the probability distribution for duration of trips for a given duration. 
* The default configuration file downloaded from the emobpy documentation does not generate workplace trips. 
    - Replace "DepartureDestinationTrip.csv" with “DepartureDestinationTrip_Worker.csv” file which uses assumptions from the MiD survey on workplace visits. 
   - Replace the default  “rules.yml” file from github with the "rules_worker.yml" file. Note that in the mobility generation the “rule key” and parameters are set to “full time”. 

# Mapping Building data to RegioStar classification
Using QGIS, map the building data to the classification of location type. This classification can be paired with the MiD survey results to use a more accurate representation of mobility patterns for a specific region. These mobility patterns can be configured in the emobpy config_files. 

“Join-regio_star_building_data.qgz” 
[main script](main.py)Clean_urbs_emobpy_data.ipynb

* Inputs: 
- “VG250_GEM.shp”: German Gemeinde shape files
    - Link to download: https://gdz.bkg.bund.de/index.php/default/verwaltungsgebiete-1-250-000-stand-31-12-vg250-31-12.html The VG250 contains the administrative levels from the state to the municipalities with the respective borders.

- “RegioStaR-Referenzdateien.csv” Classified Gemeinde ID (gemrs_20) to different regiostar classifications. 
    - Link to download: https://mcloud.de/web/guest/suche/-/results/detail/536149D1-2902-4975-9F7D-253191C0AD07

- “building_location_data.csv” Building data for use with the Urbs model

* Outputs: 
  - “Joined_building_data.csv” Labels the building data to the assigned RegioStar classification according to location.


# Preparing Emobpy data for Urbs demand input 
[main script](main.py)Clean_urbs_emobpy_data.ipynb

This notebook takes the grid electricity demand generated by emobpy and the building data and formats it as demand input and charging station availability for the Urbs model. Also generates figures with results from the urbs model. 

* Inputs: 
  - “building_data.csv"
  - “joined_building_data.csv”
  - “charge_grid.csv” 
  - “state.csv”

* Result: 
  - “demand_result.csv” time series data such that each column is labeled by the building name and the vehicle number and each row is a time step on an hour interval. Values are the grid electricity demand from the vehicle.   
    - Note that the emobpy profile generates mobility time series with half hour time steps, but urbs uses one hour time steps. Emobpy data is averaged across the half hour so that there are an equal number of timesteps input into urbs.  
  - “New_suplm.csv” filters only relevant buildings for input to urbs model
  - “New_timevareff.csv” filters only relevant buildings for input to urbs model and adds charging station availability from the emobpy data. 
  



